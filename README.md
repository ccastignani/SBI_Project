# Tutorial

## Prerequisites

* <b>Python</b> 3.0 Release

https://www.python.org/download/releases/3.0/

* <b>Modeller</b> 9.19 Release

https://anaconda.org/salilab/modeller

It is also recommended to have a program for interactive visualization and analysis of molecular structures and related data, such as <b>Chimera</b> or <b>VMD</b>.

https://www.cgl.ucsf.edu/chimera/

http://www.ks.uiuc.edu/Research/vmd/

## Input files

The input files must be <b>pairs of interacting chains</b> (.pdb), which has to be located into a directory decided by the user. This directory can also be in <i>tar.gz</i> format. 

In case you are interested in <b>rebuilding a macrocomplex</b>, you can introduce its <b>pdb file</b> (.pdb) from PDB."

## Python modules

A module is a file containing Python definitions and statements. It is important to consider that definitions from a module can be imported into other modules or into the <i>main</i> module.

* <b>sbi_project.py</b>: <i>main</i> module or program created to reconstruct a macrocomplex given a set of interacting pairs (prot-prot, prot-RNA). It also considers the possibility to rebuild a macrocomplex if the input is a macrocomplex (.pdb). 

  Aditionally, this module contains the ArgumentParser object, created using argparse module, which is used for command-line     options, arguments and sub-commands. The ArgumentParser object will hold all the information necessary to parse the command   line into Python data types.

* <b>get_interactions.py</b>: this module is <b>only</b> used by the <i>main</i> module if the given input is a macrocomplex (.pdb). It gets all possible interactions given a this structure and computes the distance between chains parining that ones which accomplish the following conditions: less than 8A between their carbons alpha (CA) and implication of at least 8 CA in this interaction. It creates the pair files (.pdb) which later, in the <i>main</i> program will be filtered by the imported module named <b>reduce_inputs_func.py</b> to get only the non-redundant interactions to build the model.

* <b>reduce_inputs_func.py</b>: this module is imported into the <i>main</i> module to speeds up the further process to create the model, as it is getting only the non-redundant interactions from the whole set of input pairs. From a set of input pairs (.pdb) compares each chain pair with the rest. This comparision has two steps: sequence and structural. First of all, a pairwise alignment is performed to determine similar sequences (cut-off = 0.9). The score of the alignment is normalized by the length of the longest sequence. If the normalized score is higher than the stablished cut-off, the analysis proceeds to the second step. In this step, a superimposition is performed between the similar chains. These similar chains are part of two different interaction pairs, which will be refered as fixed and moving chains. We apply the rotran matrix to the couple of the moving chain, which will be refered as alternative/new chain. Finally, the distances between the CA of the comparing chain (couple of the fixed chain) and the new chain are computed. If the distance is lower than 9A, the interactions will be considered the same (redundant). It saves the non-redundant chain pairs (.pdb) obtained from the reducing inputs process, which will be considered as the required input pairs to build the model.

* <b>functions.py</b>: this module is composed by a set of different <b>functions</b> to solve biological and technical problems during the analysis. Thus, it is imported into the other modules in order to use the defined functions.

* <b>utilities.py</b>: this module is composed by a set of different <b>variables</b> to solve biological and technical problems during the analysis. Thus, it is imported into the other modules in order to use the defined functions.

* <b>classes.py</b>: this module is composed by the definition of a <b>class</b> to check if the input variable is a directory or a compressed directory (.tar.gz).

* <b>DOPE_profile.py</b>: this module is <b>only</b> used if the argument '-e', '--energy_plot' is set. It creates a DOPE profile plot (.jpg) from a macrocomplex (.pdb), which has no acid nucleic chains using Modeller.

* <b>DOPE_comparison.py</b>: this module is <b>only</b> used if the argument '-ref', '--refine' is set. It refines a model previously generated with the <i>main</i> program according to the optimization parameters defined by Modeller. It also generates a comparison energy plot between the model generated by the program and the refined one.

## Output files

It is necessary to consider that the output files will depend on the command-line options and arguments the user determines while performing the analysis. All of them will be stored in the output directory selected by the user (-o or --output).

The arguments considered to fill the ArgumentParser object can be achieved by:

```
$ python3 sbi_project.py -h (or --help)
```

The following <b>arguments</b> are stablished:

* <b> -i INDIR, --input INDIR </b>
  
  It must be a directory provided by the user which contains the inputs pairs (compressed format is also
  available <i>.tar.gz</i>). In case you want to rebuild a macrocomplex from PDB, you can introduce its pdb file (.pdb).

   <i>(default: None)</i>
 

* <b> -o OUTDIR, --output OUTDIR</b>
 
  This is a directory which will be created during the program, structured in other subdirectories. 
  
  <i>(default:None)</i>
  
  
* <b> -v, --verbose</b>

  This option will allow the user to completely follow the progam. 

  <i>(default: False)</i>
  
  
* <b> -cc {0.25,0.5,1,1.2,1.5}, --clash_distance_cutoff {0.25,0.5,1,1.2,1.5} </b>
  Choose a cut-off distance to detect clashes between chains. 
 
  <i>(default: 1.2)</i>
  
  
* <b>-e, --energy_plot </b>     
  DOPE profile of the macrocomplex (not including nucleic acid chains) generated by Modeller.
 
   <i>(default: False)</i>
 
 
* <b> -ref, --refine </b>        
  Refines a model previously generated with the program according to the optimization parameters defined by Modeller.
 
  <i>(default: False)</i>
 
 
* <b> -ver {short,intensive}, --version {short,intensive}</b>
  Short version only considers the first model the program can build, while Intensive version considers all the possible
  models the program can build depending on the input pair it starts the construction of the model.
 
  <i> (default: short) </i>
 
 
 
If the <b>default options</b> are set, these are the following outputs:

<b>files</b>: 

 - alignments_results.txt: file genereated from the pairwise comparisons between all the inputs to create a dictionary of equivalences.
 
 - unique_chains_fasta.mfa: multifasta file containing the unique chains to allow the user to introduce the stoichiometry of the macrocomplex.
  
<b>files, directories and subdirectories(->)</b>:

 - <i>models (directory)</i> -> 1 (directory) -> .pdb: the generated model.
 
 - <i>reduced_inputs (directory) </i>: non-redundant interactions pdb files obtained with the reduction of inputs process.
 
(*) If <b>-ver, --version</b> intensive, inside the models directory all the possible models are created inside each subdirectory named with the number of the model.



Additionally to these previously mentioned outputs, if <b>-e, --energy_plot </b> is set, the following outputs are generated:

<b> directories and files</b>:
 - <i>models (directory) </i> -> 1 (directory) -> dope_profile.jpg (image of the plot) and .pdb.profile (DOPE profile file).
 - <i>temp (directory)</i>: temporary directory containing the pdb files without the acid nucleic chains, in order to that use them in the refining process, once the model has been built (to avoid Modeller errors).
 
 
 Additionally to these previously mentioned outputs, if <b>-ref, --refine</b> is set, the following outputs are generated:

<b> directories and files</b>:
 - <i>models (directory) </i> -> 1 (directory) -> .pdb = generated model and .pdb.B = refined.
 - <i>optimization_results (directory) </i> -> dope_profile, refined_models, stats and log_files (subdirectories). Inside dope_profiles, an image named '.pdb.dope_profile.jpg' comparing both models is created.
 - <i>temp (directory)</i>: temporary directory containing the pdb files (.pdb = generated model, .pdb.B = refined) without the acid nucleic chains, in order to that use them in the refining process, once the model has been built (to avoid Modeller errors).
 

## Authors

* **Marta Badia** - [Github](https://github.com/martabadiagraset)
* **Marta Ferri** - [Github](https://github.com/martaferri)
* **Aida Ripoll** - [Github](https://github.com/aidarripoll)


See also the list of [contributors](https://github.com/your/project/contributors) who participated in this project.

## Acknowledgments

* Hat tip to anyone who's code was used
* Inspiration
* etc
